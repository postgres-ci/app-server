{% extends "internal/layout.html" %} 

{% block content_header%}
<h1>Dashboard</h1> 
{% endblock %}

{% block menu %}
{% include "internal/layout/menu.html" with page="dashboard" %}
{% endblock %}

{% block content%} 

{% verbatim %} 
<div class="box">
    <div class="box-header">
        <h3 class="box-title">Projects</h3>
    </div>
    <div class="box-body no-padding">
        <table class="table table-striped">
            <tbody>
                <tr>
                    <th>Project</th>
                    <th>Owner</th>
                    <th width="300px">Last build</th>
                    {% if CurrentUser.IsSuperuser %}
                    <th width="80px">-</th>
                    {% endif %}
                </tr>
                {% for item in items %}
                <tr>
                    <td>
                        <a href="/project/{{ item.ProjectID }}/builds/">{{ item.ProjectName }}</a> <br>
                        {{ item.ProjectToken }}
                    </td>
                    <td>
                        {{ item.UserName }}
                    </td>
                    <td>


                    {% if item.Status == "success" %}
                    <span class="label label-success">
                    {% elif item.Status == "pending" %}
                    <span class="label label-warning">
                    {% elif item.Status == "failed" %}
                    <span class="label label-danger">
                    {% else %}
                    <span class="label label-primary">
                    {% endif %}
                    {{ item.Status }}</span>

                    {% if item.LastBuildID %}
                        (<a href="/project/{{ item.ProjectID }}/build/{{ item.LastBuildID }}/">{{ item.CommitSHA | truncatechars:15 }}</a>)
                        
                        {% if item.FinishedAt %}
                        {{ item.FinishedAt | naturaltime }}
                        {% else %}
                        started at {{ item.StartedAt | naturaltime }}
                        {% endif %}
                    {% endif %}
                    </td>
                    {% if CurrentUser.IsSuperuser %}
                    <td>
                        
                        <a href="#" data-toggle="modal" data-target="#confirmAction" data-action="/project/{{ item.ProjectID }}/delete/"><i class="fa fa-trash" aria-hidden="true"></i>delete</a>
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% if CurrentUser.IsSuperuser %}
    <div class="box-footer">
        <button type="submit" data-toggle="modal" data-target="#addProject" class="btn btn-primary">Add project</button>
    </div>
    {% endif %}
</div>
{% if CurrentUser.IsSuperuser %}
<div class="modal fade" id="addProject" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Add project</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="message-text" class="control-label">name:</label>
                    <input type="text" name="name" class="form-control">
                </div>
                <div class="form-group">
                    <label for="message-text" class="control-label">owner:</label>
                    <select class="form-control" name="owner">
                        <option>sdds</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="message-text" class="control-label">repository url</label>
                    <input type="text" name="repository_url" class="form-control">
                </div>
                <div class="form-group">
                    <label for="message-text" class="control-label">github secret</label>
                    <input type="text" name="github_secret" class="form-control">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">close</button>
                <button type="submit" class="btn btn-primary">add</button>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endverbatim %} 
{% endblock %}
